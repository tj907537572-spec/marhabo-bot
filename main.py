 import os, random, asyncio, logging
from datetime import datetime
from aiogram import Bot, Dispatcher, types
from aiogram.types import FSInputFile
from edge_tts import Communicate
import aiohttp, aiofiles
from aiohttp import web
from moviepy.editor import VideoFileClip, AudioFileClip

TOKEN = os.getenv("BOT_TOKEN")
PEXELS_API_KEY = os.getenv("PEXELS_API_KEY")
MY_ID = os.getenv("MY_ID")
CHANNEL_PSY = os.getenv("CHANNEL_PSY")
CHANNEL_BIZ = os.getenv("CHANNEL_BIZ")

bot = Bot(token=TOKEN)
dp = Dispatcher()

# --- 30 –¶–ò–¢–ê–¢ –î–õ–Ø –ö–ê–ù–ê–õ–ê –ü–°–ò–•–û–õ–û–ì–ò–Ø (–ù–ê –ú–ï–°–Ø–¶) ---
texts_psy = [
    "–¢–≤–æ—ë —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ ‚Äî —ç—Ç–æ —Ç–≤–æ—è —Å—É–ø–µ—Ä—Å–∏–ª–∞. –ù–µ –¥–∞–π —à—É–º—É –º–∏—Ä–∞ –∑–∞–≥–ª—É—à–∏—Ç—å —Å–µ–±—è.",
    "–°—á–∞—Å—Ç—å–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø—Ä–∏–Ω—è—Ç–∏—è. –¢—ã —É–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ö–æ—Ä–æ—à —Å–µ–≥–æ–¥–Ω—è.",
    "–ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤–µ–¥—É—Ç –∫ –±–æ–ª—å—à–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º. –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è.",
    "–¢–≤–æ–∏ –º—ã—Å–ª–∏ —Å–æ–∑–¥–∞—é—Ç —Ç–≤–æ—é —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å. –í—ã–±–∏—Ä–∞–π —Ç–µ, —á—Ç–æ –¥–∞—é—Ç —Ç–µ–±–µ —Å–∏–ª—É.",
    "–û—à–∏–±–∫–∏ ‚Äî —ç—Ç–æ —É—Ä–æ–∫–∏. –û–Ω–∏ –¥–µ–ª–∞—é—Ç —Ç–µ–±—è –º—É–¥—Ä–µ–µ, –∞ –Ω–µ —Å–ª–∞–±–µ–µ.",
    "–ó–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ ‚Äî —ç—Ç–æ –Ω–µ —ç–≥–æ–∏–∑–º, –∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç —Ç–≤–æ–µ–π –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.",
    "–¢–≤–æ—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –æ —Ç–µ–±–µ –¥—É–º–∞—é—Ç –¥—Ä—É–≥–∏–µ.",
    "–õ—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω ‚Äî —ç—Ç–æ —Å–µ–π—á–∞—Å. –ù–µ –∂–¥–∏ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞.",
    "–§–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ —Ç–æ–º, —á—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å, –∏ –æ—Ç–ø—É—Å—Ç–∏ –æ—Å—Ç–∞–ª—å–Ω–æ–µ.",
    "–í–µ—Ä—å –≤ —Å–µ–±—è, –¥–∞–∂–µ –µ—Å–ª–∏ –≤–µ—Å—å –º–∏—Ä —Å–æ–º–Ω–µ–≤–∞–µ—Ç—Å—è. –¢—ã ‚Äî —Å–≤–æ—è –≥–ª–∞–≤–Ω–∞—è –æ–ø–æ—Ä–∞.",
    "–ü—Ä–æ—à–ª–æ–µ —É–∂–µ —É—à–ª–æ, –±—É–¥—É—â–µ–µ –µ—â–µ –Ω–µ –Ω–∞—Å—Ç–∞–ª–æ. –ñ–∏–≤–∏ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–º.",
    "–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è ‚Äî —Ç–≤–æ–π —Å–∞–º—ã–π —Ü–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å. –¢—Ä–∞—Ç—å –µ—ë –Ω–∞ —Å–æ–∑–∏–¥–∞–Ω–∏–µ.",
    "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –≤–æ—Ä —Ä–∞–¥–æ—Å—Ç–∏. –¢–≤–æ–π –ø—É—Ç—å —É–Ω–∏–∫–∞–ª–µ–Ω –∏ –Ω–µ–ø–æ–≤—Ç–æ—Ä–∏–º.",
    "–ü–æ–∑–≤–æ–ª—å —Å–µ–±–µ –±—ã—Ç—å –Ω–µ–∏–¥–µ–∞–ª—å–Ω—ã–º. –í —ç—Ç–æ–º —Ç–≤–æ—è –Ω–∞—Å—Ç–æ—è—â–∞—è –∫—Ä–∞—Å–æ—Ç–∞.",
    "–¢—Ä—É–¥–Ω–æ—Å—Ç–∏ ‚Äî —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è —Ä–æ—Å—Ç–∞. –°—Ç–∞–Ω–æ–≤–∏—Å—å –ª—É—á—à–µ —á–µ—Ä–µ–∑ –Ω–∏—Ö.",
    "–¢–≤–æ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∏—Ä –≤–∞–∂–Ω–µ–µ –≤–Ω–µ—à–Ω–∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π. –ë–µ—Ä–µ–≥–∏ –µ–≥–æ.",
    "–£–º–µ–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç—å '–Ω–µ—Ç' ‚Äî —ç—Ç–æ –ø—Ä–∏–∑–Ω–∞–∫ –≤—ã—Å–æ–∫–æ–π —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏.",
    "–°—Ç—Ä–∞—Ö ‚Äî —ç—Ç–æ –ª–∏—à—å —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –≥–¥–µ —Å–∫—Ä—ã—Ç —Ç–≤–æ–π —Ä–æ—Å—Ç.",
    "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî —ç—Ç–æ –Ω–æ–≤—ã–π —à–∞–Ω—Å –Ω–∞—á–∞—Ç—å –≤—Å—ë —Å–Ω–∞—á–∞–ª–∞. –ò—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ.",
    "–î–æ–±—Ä–æ—Ç–∞ –∫ —Å–µ–±–µ ‚Äî –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –ª—é–±—ã–º —Å—Ç—Ä–µ—Å—Å–æ–º.",
    "–¢—ã ‚Äî –∞–≤—Ç–æ—Ä —Å–≤–æ–µ–π –∏—Å—Ç–æ—Ä–∏–∏. –ü–∏—à–∏ –µ—ë —Ç–∞–∫, –∫–∞–∫ —Ö–æ—á–µ—à—å —Ç—ã.",
    "–¢–∏—à–∏–Ω–∞ –≤–Ω—É—Ç—Ä–∏ ‚Äî –∑–∞–ª–æ–≥ —è—Å–Ω–æ–≥–æ —É–º–∞. –ù–∞–π–¥–∏ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–∫–æ—è.",
    "–¢–≤–æ—ë –æ–∫—Ä—É–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –í—ã–±–∏—Ä–∞–π –ª—É—á—à–∏—Ö.",
    "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –º–µ–Ω—è–µ—Ç –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –º–∏—Ä–∞. –ù–∞—á–Ω–∏ –¥–µ–Ω—å —Å '—Å–ø–∞—Å–∏–±–æ'.",
    "–ù–µ –±–æ–π—Å—è –Ω–∞—á–∏–Ω–∞—Ç—å —Å –Ω—É–ª—è. –≠—Ç–æ –ø—É—Ç—å –∫ –≤–µ—Ä—à–∏–Ω–µ.",
    "–°–ª—É—à–∞–π —Å–≤–æ–µ —Å–µ—Ä–¥—Ü–µ, –æ–Ω–æ –∑–Ω–∞–µ—Ç –¥–æ—Ä–æ–≥—É –ª—É—á—à–µ, —á–µ–º –ª–æ–≥–∏–∫–∞.",
    "–¢–µ—Ä–ø–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –∫–ª—é—á –∫–æ –≤—Å–µ–º –¥–≤–µ—Ä—è–º. –í—Å—ë –ø—Ä–∏–¥–µ—Ç –≤–æ–≤—Ä–µ–º—è.",
    "–¢–≤–æ–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –±–µ–∑–≥—Ä–∞–Ω–∏—á–µ–Ω. –ù–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π —Å–µ–±—è —Ä–∞–º–∫–∞–º–∏.",
    "–ë—É–¥—å —Å–æ–±–æ–π. –û—Ä–∏–≥–∏–Ω–∞–ª –≤—Å–µ–≥–¥–∞ –¥–æ—Ä–æ–∂–µ, —á–µ–º –ª—é–±–∞—è –∫–æ–ø–∏—è.",
    "–£—Å–ø–µ—Ö ‚Äî —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É–º–∞. –ù–∞—á–Ω–∏ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è —É—Å–ø–µ—à–Ω—ã–º —Å–µ–π—á–∞—Å."
]

# --- 30 –°–¢–†–ê–¢–ï–ì–ò–ô –ò –ò–î–ï–ô –î–õ–Ø –ö–ê–ù–ê–õ–ê –ë–ò–ó–ù–ï–° (–ù–ê –ú–ï–°–Ø–¶) ---
texts_biz = [
    "–ë–∏–∑–Ω–µ—Å-–∏–¥–µ—è: —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–π—Ä–æ-–∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –±—Ä–µ–Ω–¥–æ–≤ –ø–æ–¥ –∫–ª—é—á.",
    "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: –ø—Ä–∞–≤–∏–ª–æ 80/20 ‚Äî —Ñ–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º –¥–ª—è —Ä–æ—Å—Ç–∞ –¥–æ—Ö–æ–¥–∞.",
    "–ò–Ω–≤–µ—Å—Ç–∏—Ä—É–π –≤ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è ‚Äî —ç—Ç–æ –∞–∫—Ç–∏–≤ —Å —Å–∞–º–æ–π –≤—ã—Å–æ–∫–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å—é.",
    "–ò–¥–µ—è: –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–æ–≤.",
    "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ª–∞–≥–∞–π—Å—è –Ω–∞ –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–æ—Ö–æ–¥–∞. –î–∏–≤–µ—Ä—Å–∏—Ñ–∏—Ü–∏—Ä—É–π.",
    "–ë–∏–∑–Ω–µ—Å-–∏–¥–µ—è: —Å–µ—Ä–≤–∏—Å –ø–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ —Ç—Ä–µ–Ω–¥–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞—Ö.",
    "–°—Ç—Ä–∞—Ç–µ–≥–∏—è '–°–∏–Ω–µ–≥–æ –æ–∫–µ–∞–Ω–∞': —Å–æ–∑–¥–∞–≤–∞–π —Å–ø—Ä–æ—Å —Ç–∞–º, –≥–¥–µ –Ω–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤.",
    "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –±—å–µ—Ç —Ç–∞–ª–∞–Ω—Ç. –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å ‚Äî –≥–ª–∞–≤–Ω—ã–π —Å–µ–∫—Ä–µ—Ç –±–æ–ª—å—à–∏—Ö –¥–µ–Ω–µ–≥.",
    "–ò–¥–µ—è: –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é –ò–ò –≤ –º–∞–ª—ã–π –∏ —Å—Ä–µ–¥–Ω–∏–π –±–∏–∑–Ω–µ—Å.",
    "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–¥–∞–π, –ø–æ—Ç–æ–º —Å–æ–∑–¥–∞–≤–∞–π. –í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π —Å–ø—Ä–æ—Å.",
    "–ë–∏–∑–Ω–µ—Å ‚Äî —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ —á—É–∂–∏—Ö –ø—Ä–æ–±–ª–µ–º –∑–∞ –¥–µ–Ω—å–≥–∏. –ù–∞–π–¥–∏ –±–æ–ª—å —Ä—ã–Ω–∫–∞.",
    "–¢–≤–æ–π –Ω–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥ ‚Äî —ç—Ç–æ —Ç–≤–æ–π –∫–∞–ø–∏—Ç–∞–ª. –û–±—â–∞–π—Å—è —Å —É—Å–ø–µ—à–Ω—ã–º–∏ –ª—é–¥—å–º–∏.",
    "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π –≤—Å—ë, —á—Ç–æ –º–æ–∂–Ω–æ. –¢–≤–æ–µ –≤—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ —Å—Ç–æ–∏—Ç—å –¥–æ—Ä–æ–≥–æ.",
    "–ò–¥–µ—è: —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ —Å –ø–ª–∞—Ç–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –ø–æ —Ç–≤–æ–µ–π –Ω–∏—à–µ.",
    "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: —Ñ–æ–∫—É—Å –Ω–∞ —É–¥–µ—Ä–∂–∞–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤–∞–∂–Ω–µ–µ, —á–µ–º –ø–æ–∏—Å–∫ –Ω–æ–≤—ã—Ö.",
    "–ë–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å: –¥—Ä–æ–ø—à–∏–ø–ø–∏–Ω–≥ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ —Å–æ—Ü—Å–µ—Ç–∏.",
    "–î–µ–ª–µ–≥–∏—Ä—É–π —Ä—É—Ç–∏–Ω—É, —á—Ç–æ–±—ã –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–≤–∏—Ç–∏–µ–º.",
    "–ò–¥–µ—è: –∑–∞–ø—É—Å–∫ —à–∫–æ–ª—ã –ø–æ –æ–±—É—á–µ–Ω–∏—é –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã–º –æ–Ω–ª–∞–π–Ω-–ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º.",
    "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤, –¥–µ–ª–∞–π –ª—É—á—à–µ –∏ –±—ã—Å—Ç—Ä–µ–µ –∏—Ö.",
    "–ò–Ω–≤–µ—Å—Ç–∏—Ä—É–π –≤ –ª–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥. –õ—é–¥–∏ –ø–æ–∫—É–ø–∞—é—Ç —É –ª—é–¥–µ–π, –∞ –Ω–µ —É –∫–æ–º–ø–∞–Ω–∏–π.",
    "–ë–∏–∑–Ω–µ—Å-–∏–¥–µ—è: –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ –ø–æ –º–æ–Ω—Ç–∞–∂—É –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∏–¥–µ–æ (Reels/Shorts).",
    "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç (MVP) ‚Äî –∑–∞–ø—É—Å–∫–∞–π—Å—è –±—ã—Å—Ç—Ä–æ.",
    "–î–µ–Ω—å–≥–∏ –ª—é–±—è—Ç —Å–∫–æ—Ä–æ—Å—Ç—å. –ü—Ä–∏–Ω–∏–º–∞–π —Ä–µ—à–µ–Ω–∏—è –±—ã—Å—Ç—Ä–æ –∏ —Ç–µ—Å—Ç–∏—Ä—É–π –≥–∏–ø–æ—Ç–µ–∑—ã.",
    "–ò–¥–µ—è: —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Ç-–±–æ—Ç–æ–≤ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π (–∫–∞—Ñ–µ, —Å–∞–ª–æ–Ω—ã).",
    "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: –º–∞—Å—à—Ç–∞–±–∏—Ä—É–π —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —É–∂–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç –ø—Ä–∏–±—ã–ª—å.",
    "–†–∏—Å–∫—É–π –æ–±–¥—É–º–∞–Ω–Ω–æ. –°—Ç—Ä–∞—Ö –ø–æ—Ç–µ—Ä–∏ –Ω–µ –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ä–∞–∑–≤–∏—Ç–∏–µ.",
    "–ë–∏–∑–Ω–µ—Å-–∏–¥–µ—è: –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ —ç–∫–æ–ª–æ–≥–∏—á–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–¥ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –±—Ä–µ–Ω–¥–æ–º.",
    "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: –±—É–¥—å –Ω–∞ —à–∞–≥ –≤–ø–µ—Ä–µ–¥–∏ —Ç—Ä–µ–Ω–¥–æ–≤. –ò–∑—É—á–∞–π —Ä—ã–Ω–æ–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.",
    "–ß–µ—Å—Ç–Ω–æ—Å—Ç—å ‚Äî –ª—É—á—à–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞.",
    "–¢–≤–æ–π —É—Å–ø–µ—Ö –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–≤–æ–µ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –ø–µ—Ä–µ–º–µ–Ω–∞–º."
]

async def create_video_logic(text, chat_id):
    v_in, a_in, v_out = f"v_{chat_id}.mp4", f"a_{chat_id}.mp3", f"res_{chat_id}.mp4"
    headers = {"Authorization": PEXELS_API_KEY}
    url = "https://api.pexels.com/videos/search?query=nature&per_page=40&orientation=portrait"

    try:
        async with aiohttp.ClientSession() as session:
            async with session.get(url, headers=headers) as resp:
                data = await resp.json()
                v_link = random.choice(data['videos'])['video_files'][0]['link']
                async with session.get(v_link) as vr:
                    async with aiofiles.open(v_in, mode='wb') as f:
                        await f.write(await vr.read())

        await Communicate(text, "ru-RU-SvetlanaNeural").save(a_in)

        clip = VideoFileClip(v_in)
        duration = min(clip.duration, 8)
        clip = clip.subclip(0, duration).without_audio().resize(height=480) 
        
        audio = AudioFileClip(a_in)
        final = clip.set_audio(audio)
        final.write_videofile(v_out, codec="libx264", audio_codec="aac", fps=24, logger=None)
        
        clip.close(); audio.close()
        return v_out
    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞ –º–æ–Ω—Ç–∞–∂–∞: {e}")
        return None
    finally:
        for f in [v_in, a_in]:
            if os.path.exists(f): os.remove(f)

async def send_auto_posts():
    v1 = await create_video_logic(random.choice(texts_psy), "auto_psy")
    if v1:
        await bot.send_video(CHANNEL_PSY, FSInputFile(v1), caption="üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è")
        os.remove(v1)
    
    v2 = await create_video_logic(random.choice(texts_biz), "auto_biz")
    if v2:
        await bot.send_video(CHANNEL_BIZ, FSInputFile(v2), caption="üöÄ –ò–¥–µ—è –∏ –¥–æ—Ö–æ–¥")
        os.remove(v2)

async def scheduler():
    while True:
        now = datetime.now().strftime("%H:%M")
        if now in ["09:00", "18:00"]:
            await send_auto_posts()
            await asyncio.sleep(60) 
        await asyncio.sleep(30)

@dp.message()
async def handle_msg(message: types.Message):
    if str(message.from_user.id) == str(MY_ID):
        if message.text.lower().startswith("—Å–¥–µ–ª–∞–π"):
            clean_text = message.text.lower().replace("—Å–¥–µ–ª–∞–π", "").strip()
            msg = await message.answer("‚è≥ –°–æ–∑–¥–∞—é –≤–∏–¥–µ–æ...")
            video = await create_video_logic(clean_text, message.from_user.id)
            if video:
                await message.answer_video(FSInputFile(video), caption="–ì–æ—Ç–æ–≤–æ!")
                os.remove(video)
            else:
                await message.answer("‚ùå –û—à–∏–±–∫–∞.")
            await msg.delete()
        else:
            await message.answer("–ü—Ä–∏–≤–µ—Ç! –ù–∞–ø–∏—à–∏ '–°–¥–µ–ª–∞–π [—Ç–µ–∫—Å—Ç]', —á—Ç–æ–±—ã —è —Å–æ–∑–¥–∞–ª –≤–∏–¥–µ–æ.")

async def main():
    app = web.Application()
    app.router.add_get("/", lambda r: web.Response(text="Live"))
    runner = web.AppRunner(app)
    await runner.setup()
    await web.TCPSite(runner, '0.0.0.0', 10000).start()
    await bot.delete_webhook(drop_pending_updates=True) 
    asyncio.create_task(scheduler())
    await dp.start_polling(bot)

if __name__ == "__main__":
    logging.basicConfig(level=logging.INFO)
    asyncio.run(main())
   
